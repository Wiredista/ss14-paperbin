<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SS14 Paperbin</title>
    <script src="vendor/jquery-3.7.1.min.js"></script>
    <link rel="stylesheet" href="vendor/bootstrap.min.css">
    <script src="vendor/bootstrap.bundle.min.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="container mt-4">
        <h1>Paperbin</h1>
        <p>Este é um gerador de documentos para uso no jogo Space Station 14. Ele permite a criação de documentos personalizados ou a partir de templates.</p>
    </header>

    <!-- Form -->
    <form action="" method="get" class="container card p-4">
        <div class="form-group">
            <label for="stationName">Código da estação:</label>
            <input type="text" id="stationName" class="form-control" placeholder="XX-###">
        </div>

        <!-- Template -->
        <div class="form-check mt-3">
            <input type="radio" name="bodyOrTemplate" id="template" class="form-check-input" checked>
            <label class="form-check-label" for="template">Usar template:</label>
        </div>
        <div class="form-group">
            <select name="template" id="" class="form-control"></select>
        </div>

        <!-- Custom document -->
        <div class="form-check mt-3">
            <input type="radio" name="bodyOrTemplate" id="body" class="form-check-input">
            <label class="form-check-label" for="body">Documento personalizado:</label>
        </div>
        <div class="card p-4">
            <!-- Syndicate or NanoTrasen -->
            <div class="form-group">
                <label for="syndicateOrNano">Filiação:</label>
            </div>
            <div class="form-check">
                <input type="radio" name="syndicateOrNano" id="syndicate" class="form-check-input">
                <label class="form-check-label" for="syndicate">Sindicato</label>
            </div>
            <div class="form-check">
                <input type="radio" name="syndicateOrNano" id="nano" class="form-check-input" checked>
                <label class="form-check-label" for="nano">NanoTrasen</label>
            </div>
            <div class="form-group">
                <label for="documentTitle">Título:</label>
                <input type="text" id="documentTitle" class="form-control">
            </div>
            <div class="form-group">
                <label for="documentBody">Corpo:</label>
                <textarea id="documentBody" class="form-control"></textarea>
            </div>
        </div>  
        
        <div class="form-group mt-3">
            <button type="submit" class="btn btn-primary float-end">Enviar</button>
        </div>

        <!-- Output -->
        <div class="form-group mt-3">
            <label for="ouput">Saída:</label>
            <textarea name="" id="ouput" class="form-control" rows="5"></textarea>
            <button class="btn btn-primary mt-2" onclick="$('#ouput').select(); document.execCommand('copy');">Copiar</button>
        </div>
    </form>
    <script>
        // Load templates into select
        $.get("templates.json", function(data){
            for (let key in data) {
                value = data[key];
                let option = $("<option>").val(value).text(key);
                $("select").append(option);
            }
        });

        // Preload base templates for performance
        let baseTemplateNT;
        let baseTemplateSyndicate;

        $.get("templates/base-nanotrasen.txt", (data) => { baseTemplateNT = data; });
        $.get("templates/base-syndicate.txt",  (data) => { baseTemplateSyndicate = data; });

        // Trigger form submission on template change
        $("select").change(function(){
            $("form").submit();
        });
        
        // Form submission
        $("form").submit(function(e){
            e.preventDefault();
            const bodyOrTemplate = $("input[name=bodyOrTemplate]:checked").attr("id");

            // Template handling
            if (bodyOrTemplate == "template") {
                const template = $("select").val();
                const stationName = $("#stationName").val();
                const documentTitle = $("#documentTitle").val();
                const documentBody = $("#documentBody").val();
                
                const path = "templates/" + template;
                $.get(path, function(data){
                    data = data.replace("{{STATION.SN}}", stationName);    
                    $("#ouput").val(data);
                });
            }

            // Custom document handling
            else if (bodyOrTemplate == "body") {
                const stationName = $("#stationName").val();
                const documentTitle = $("#documentTitle").val();
                const documentBody = $("#documentBody").val();
                
                // Choose base template based on affiliation
                let baseTemplate;
                if ($("input[name=syndicateOrNano]:checked").attr("id") == "syndicate") {
                    baseTemplate = baseTemplateSyndicate;
                } else {
                    baseTemplate = baseTemplateNT;
                }

                // Replace placeholders
                let string = baseTemplate;
                string = string.replace("{{STATION.SN}}", stationName);
                string = string.replace("{{DOCUMENT.TITLE}}", documentTitle);
                string = string.replace("{{DOCUMENT.BODY}}", documentBody);

                $("#ouput").val(string);
            }
        });
    </script>

    <!-- Footer -->
    <footer class="container mt-5 text-center">
        <p>Feito por <a href="https://github.com/Wiredista">Wiredista</a></p>
    </footer>   
</body>
</html>